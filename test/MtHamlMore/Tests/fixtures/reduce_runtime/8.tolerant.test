--FILE--
<?php

$href='www.g.cn';
$item=array('type'=>'car','urgency'=>'loop','number'=>3,'is_empty'=>false);
$item2=array('type'=>'truck','urgency'=>'loop','number'=>33,'is_empty'=>true);
$sortdir='desc';
$sortcol=$item;

$compiled =  MtHamlMore\Entry::compilePhpMoreHaml( $parts['HAML'],array('enable_escaper'=>false),array(
    'reduce_runtime' => true,
    'reduce_runtime_array_tolerant'=>true,
));
$compiled_file=$file.'..php';
file_put_contents($compiled_file,$compiled);
include $compiled_file;
--HAML--
%a{:title=>"title",:href=>$href,:id=>strlen($href)} Stuff
#div{:class => array($item2['type'], $item2['urgency']), :id => array($item2['type'], $item2['number']>3?'big' :'small') }
%div.add{:class => array($item['type'], $item == $sortcol ? array('sort', $sortdir):null) } Contents
--EXPECT--
<a title="title" href="www.g.cn" id="8">Stuff</a>
<div class="truck loop" id="truck-big"></div>
<div class="add car sort desc">Contents</div>

--EXPECT_PHP--
<a title="title"<?php if(!is_null($href)) echo ' href="',htmlspecialchars($href, ENT_QUOTES, 'UTF-8'),'"' ;$__mthamlmore_attri_value= strlen($href);
if(!is_null($__mthamlmore_attri_value)) echo ' id="',htmlspecialchars($__mthamlmore_attri_value, ENT_QUOTES, 'UTF-8'),'"' ; ?>>Stuff</a>
<div<?php $__mthamlmore_attri_value= implode(' ',array_filter(array($item2['type'],$item2['urgency']),function($v){return is_null($v)?false:true;}));
if($__mthamlmore_attri_value!=="") echo ' class="',htmlspecialchars($__mthamlmore_attri_value, ENT_QUOTES, 'UTF-8'),'"' ;$__mthamlmore_attri_value= implode('-',array_filter(array($item2['type'],$item2['number']>3?'big' :'small'),function($v){return is_null($v)?false:true;}));
if($__mthamlmore_attri_value!=="") echo ' id="',htmlspecialchars($__mthamlmore_attri_value, ENT_QUOTES, 'UTF-8'),'"' ; ?>></div>
<div<?php $__mthamlmore_attri_value= implode(' ',array_filter(iterator_to_array(new RecursiveIteratorIterator( new RecursiveArrayIterator( array('add',$item['type'],$item == $sortcol ? array('sort', $sortdir):null) )), FALSE),function($v){return is_null($v)?false:true;}));
if($__mthamlmore_attri_value!=="") echo ' class="',htmlspecialchars($__mthamlmore_attri_value, ENT_QUOTES, 'UTF-8'),'"' ; ?>>Contents</div>

